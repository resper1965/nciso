{
  "name": "nciso",
  "description": "n.CISO - Information Security Management Platform",
  "version": "1.0.0",
  "type": "application",
  "services": [
    {
      "name": "backend",
      "type": "nodejs",
      "port": 3000,
      "build": {
        "dockerfile": "Dockerfile.backend"
      },
      "environment": {
        "NODE_ENV": "production",
        "PORT": "3000"
      },
      "labels": {
        "traefik.enable": "true",
        "traefik.http.routers.backend.rule": "Host(`api.${DOMAIN}`) || PathPrefix(`/api`)",
        "traefik.http.routers.backend.entrypoints": "websecure",
        "traefik.http.routers.backend.tls.certresolver": "letsencrypt",
        "traefik.http.services.backend.loadbalancer.server.port": "3000",
        "traefik.http.middlewares.backend-stripprefix.stripprefix.prefixes": "/api",
        "traefik.http.routers.backend.middlewares": "backend-stripprefix"
      }
    },
    {
      "name": "frontend",
      "type": "nodejs",
      "port": 3000,
      "build": {
        "dockerfile": "Dockerfile.frontend"
      },
      "environment": {
        "NODE_ENV": "production",
        "NEXT_PUBLIC_API_URL": "https://api.${DOMAIN}"
      },
      "labels": {
        "traefik.enable": "true",
        "traefik.http.routers.frontend.rule": "Host(`${DOMAIN}`)",
        "traefik.http.routers.frontend.entrypoints": "websecure",
        "traefik.http.routers.frontend.tls.certresolver": "letsencrypt",
        "traefik.http.services.frontend.loadbalancer.server.port": "3000",
        "traefik.http.routers.frontend.priority": "1"
      }
    }
  ],
  "networks": {
    "nciso-network": {
      "external": true
    }
  }
}
