# M√≥dulo n.Controls

Este m√≥dulo implementa o cat√°logo centralizado de controles de seguran√ßa com suporte completo a internacionaliza√ß√£o (i18n) e estrutura modular organizada.

## üèóÔ∏è Estrutura Modular

```
src/modules/n.controls/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ControlCard.tsx        # Card de exibi√ß√£o de controle
‚îÇ   ‚îú‚îÄ‚îÄ ControlForm.tsx        # Formul√°rio de cria√ß√£o/edi√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ ControlFilters.tsx     # Componente de filtros com i18n
‚îÇ   ‚îú‚îÄ‚îÄ ControlStatusBadge.tsx # Badge de status com cores
‚îÇ   ‚îú‚îÄ‚îÄ ControlsList.tsx       # Lista principal de controles
‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Exporta√ß√µes dos componentes
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useControlFilters.ts   # Hook para gerenciar filtros
‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Exporta√ß√µes dos hooks
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ ControlsService.ts     # Service para opera√ß√µes CRUD
‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Exporta√ß√µes dos services
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Tipos TypeScript do m√≥dulo
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ ControlsListWithFilters.tsx  # Exemplo de uso dos filtros
‚îÇ   ‚îî‚îÄ‚îÄ ControlStatusBadgeExample.tsx # Exemplo do badge de status
‚îî‚îÄ‚îÄ index.ts                  # Exporta√ß√µes principais do m√≥dulo
```

## üß© Componentes

### ControlStatusBadge
Badge visual para exibir status dos controles com cores padronizadas:
- **Ativo**: Verde üü¢
- **Inativo**: Cinza ‚ö™
- **Rascunho**: Amarelo üü°
- **Arquivado**: Vermelho üî¥

```tsx
import { ControlStatusBadge } from '@/modules/n.controls'

<ControlStatusBadge status="active" />
```

### ControlFilters
Componente de filtros com tradu√ß√£o din√¢mica para todos os campos:
- Busca por texto
- Filtro por tipo (preventive, corrective, detective, deterrent)
- Filtro por status (active, inactive, draft, archived)
- Filtro por framework (iso27001, nist, cobit, custom)
- Filtro por dom√≠nio (14 dom√≠nios de seguran√ßa)
- Filtro por prioridade (low, medium, high, critical)

```tsx
import { ControlFilters, useControlFilters } from '@/modules/n.controls'

const { filters, updateFilter, clearFilters } = useControlFilters()

<ControlFilters
  filters={filters}
  onFilterChange={updateFilter}
  onClearFilters={clearFilters}
/>
```

### ControlCard
Card para exibi√ß√£o de controle individual com:
- Informa√ß√µes principais (nome, descri√ß√£o, tipo, status)
- Badges coloridos para status e prioridade
- Barra de progresso para efetividade
- Menu de a√ß√µes (visualizar, editar, duplicar, excluir)

### ControlForm
Formul√°rio completo para cria√ß√£o/edi√ß√£o de controles com:
- Valida√ß√£o via Zod
- Campos obrigat√≥rios e opcionais
- Slider para efetividade (0-100%)
- Seletores para tipo, dom√≠nio, framework, status, prioridade
- Suporte a tradu√ß√£o din√¢mica

### ControlsList
Lista principal de controles com:
- Visualiza√ß√£o em tabela ou grid
- Pagina√ß√£o
- Filtros avan√ßados
- Estat√≠sticas
- A√ß√µes em lote

### ControlFrameworkMapper
Componente para associar controles a frameworks via checklist:

- **Interface Intuitiva**: Checkboxes para sele√ß√£o r√°pida
- **Estado em Tempo Real**: Reflete mapeamentos existentes
- **Persist√™ncia Autom√°tica**: Salva altera√ß√µes no Supabase
- **Feedback Visual**: Toasts de sucesso/erro
- **Estat√≠sticas**: Contadores de mapeados/n√£o mapeados
- **Multi-tenant**: Isolamento por tenant via RLS

```tsx
import { ControlFrameworkMapper } from '@/modules/n.controls'

<ControlFrameworkMapper 
  controlId="123-abc"
  controlName="Controle de Acesso"
  showStats={true}
/>
```

### FrameworkCoverageChart
Componente para relat√≥rio visual de cobertura de controles por framework:

- **Gr√°lficos Interativos**: Barras, pizza e linha com Recharts
- **Estat√≠sticas em Tempo Real**: Totais e percentuais
- **Filtros Din√¢micos**: Por dom√≠nio, tipo e framework
- **Insights Autom√°ticos**: An√°lises baseadas nos dados
- **Rankings**: Top e bottom frameworks
- **Tooltips Informativos**: Detalhes ao passar o mouse
- **Responsivo**: Mobile-first design

```tsx
import { FrameworkCoverageChart } from '@/modules/n.controls'

<FrameworkCoverageChart 
  tenantId="123-abc"
  showFilters={true}
  chartType="bar"
/>
```

### ExportMappingButton
Componente para exporta√ß√£o de mapeamentos controle-framework:

- **M√∫ltiplos Formatos**: CSV e JSON
- **Filtros Din√¢micos**: Aplicados na exporta√ß√£o
- **Valida√ß√£o de Permiss√µes**: Por tenant
- **Preview com Estat√≠sticas**: Antes da exporta√ß√£o
- **Nomenclatura Autom√°tica**: Com timestamp e filtros
- **Download Autom√°tico**: Via blob no navegador
- **Compatibilidade**: Excel e ferramentas de auditoria

```tsx
import { ExportMappingButton } from '@/modules/n.controls'

<ExportMappingButton 
  tenantId="123-abc"
  filters={{
    domain: 'access_control',
    type: 'preventive'
  }}
  variant="outline"
/>
```

## üé£ Hooks

### useControlFilters
Hook personalizado para gerenciar o estado dos filtros:

```tsx
const {
  filters,           // Estado atual dos filtros
  updateFilter,      // Fun√ß√£o para atualizar um filtro
  clearFilters,      // Fun√ß√£o para limpar todos os filtros
  hasActiveFilters,  // Boolean indicando se h√° filtros ativos
  getActiveFiltersCount, // N√∫mero de filtros ativos
  getFilterSummary   // Resumo dos filtros ativos
} = useControlFilters()

### useFrameworkMapping
Hook personalizado para gerenciar mapeamento de controles e frameworks:

```tsx
const {
  frameworks,           // Lista de frameworks dispon√≠veis
  mappedFrameworks,    // IDs dos frameworks mapeados
  loading,             // Estado de carregamento
  updating,            // Estado de atualiza√ß√£o
  toggleMapping,       // Fun√ß√£o para alternar mapeamento
  isFrameworkMapped,   // Fun√ß√£o para verificar se est√° mapeado
  getStats,            // Fun√ß√£o para obter estat√≠sticas
  refresh              // Fun√ß√£o para recarregar dados
} = useFrameworkMapping({ controlId: '123-abc' })

### useCoverageStats
Hook personalizado para gerenciar dados de cobertura de controles por framework:

```tsx
const {
  coverageData,           // Dados de cobertura por framework
  summary,                // Estat√≠sticas gerais
  loading,                // Estado de carregamento
  error,                  // Erro se houver
  hasData,                // Boolean indicando se h√° dados
  getChartData,           // Dados formatados para gr√°ficos
  getPieChartData,        // Dados para gr√°fico de pizza
  getTopFrameworks,       // Frameworks com melhor cobertura
  getBottomFrameworks,    // Frameworks com pior cobertura
  getColorForCoverage,    // Fun√ß√£o para cores baseadas na cobertura
  getInsights,            // Insights autom√°ticos
  refresh                 // Fun√ß√£o para recarregar dados
} = useCoverageStats({ tenantId: '123-abc', filters: {} })
```

## üîß Services

### ControlsService
Service para opera√ß√µes CRUD e consultas:

```tsx
import { ControlsService } from '@/modules/n.controls'

// Listar controles
const controls = await ControlsService.list(filters, page, limit)

// Criar controle
const newControl = await ControlsService.create(controlData)

// Atualizar controle
const updatedControl = await ControlsService.update(id, controlData)

// Excluir controle
await ControlsService.delete(id)

// Obter estat√≠sticas
const stats = await ControlsService.getStats()
```

## üìù Tipos

Todos os tipos TypeScript est√£o centralizados em `types/index.ts`:

- `Control`: Interface principal do controle
- `ControlType`: Tipos de controle (preventive, corrective, detective, deterrent)
- `ControlStatus`: Status do controle (active, inactive, draft, archived)
- `ControlPriority`: Prioridades (low, medium, high, critical)
- `ControlFramework`: Frameworks (iso27001, nist, cobit, custom)
- `ControlDomain`: Dom√≠nios de seguran√ßa
- `ControlFilters`: Filtros para consultas
- `ControlStats`: Estat√≠sticas dos controles
- `ControlFormData`: Dados do formul√°rio
- `ControlValidationErrors`: Erros de valida√ß√£o

## üåç Tradu√ß√µes

O m√≥dulo suporta tr√™s idiomas:

- **pt-BR** (Portugu√™s Brasileiro)
- **en-US** (Ingl√™s Americano)
- **es** (Espanhol)

### Chaves de Tradu√ß√£o Principais

```json
{
  "controls": {
    "filters": {
      "title": "Filtros",
      "all_types": "Todos os tipos",
      "all_status": "Todos os status",
      "all_frameworks": "Todos os frameworks",
      "all_domains": "Todos os dom√≠nios",
      "all_priorities": "Todas as prioridades"
    },
    "types": {
      "preventive": "Preventivo",
      "corrective": "Corretivo",
      "detective": "Detetivo",
      "deterrent": "Dissuasivo"
    },
    "status": {
      "active": "Ativo",
      "inactive": "Inativo",
      "draft": "Rascunho",
      "archived": "Arquivado"
    }
  }
}
```

## ‚úÖ Caracter√≠sticas Implementadas

- [x] **Estrutura Modular**: Organiza√ß√£o por responsabilidade
- [x] **Internacionaliza√ß√£o Completa**: Todos os labels traduzidos
- [x] **Componentes Reutiliz√°veis**: ControlStatusBadge, ControlFilters
- [x] **Hook Personalizado**: useControlFilters para gerenciar estado
- [x] **Hook de Mapeamento**: useFrameworkMapping para frameworks
- [x] **Hook de Cobertura**: useCoverageStats para relat√≥rios
- [x] **Service Centralizado**: ControlsService para opera√ß√µes CRUD
- [x] **Tipos TypeScript**: Tipagem completa e organizada
- [x] **Suporte a Temas**: Dark mode nos componentes
- [x] **Valida√ß√£o**: Zod + React Hook Form
- [x] **Acessibilidade**: ARIA labels e roles apropriados
- [x] **Performance**: useCallback para otimiza√ß√£o
- [x] **Mapeamento de Frameworks**: Interface checklist para associa√ß√µes
- [x] **Relat√≥rio de Cobertura**: Gr√°ficos interativos com Recharts
- [x] **Exporta√ß√£o de Mapeamentos**: CSV e JSON com filtros

## üéØ Benef√≠cios

1. **Modularidade**: Cada responsabilidade em sua pasta
2. **Reutiliza√ß√£o**: Componentes podem ser usados em outros m√≥dulos
3. **Manutenibilidade**: C√≥digo organizado e documentado
4. **Escalabilidade**: F√°cil adi√ß√£o de novos recursos
5. **Consist√™ncia**: Padr√µes uniformes em todo o m√≥dulo

## üîÑ Uso

```tsx
import { 
  ControlsList, 
  ControlStatusBadge, 
  ControlFilters,
  ControlFrameworkMapper,
  FrameworkCoverageChart,
  ExportMappingButton,
  useControlFilters,
  useFrameworkMapping,
  useCoverageStats
} from '@/modules/n.controls'

function MyPage() {
  return (
    <div>
      <ControlStatusBadge status="active" />
      <ControlsList />
      <ControlFrameworkMapper 
        controlId="123-abc"
        controlName="Controle de Acesso"
      />
      <FrameworkCoverageChart 
        tenantId="123-abc"
        showFilters={true}
        chartType="bar"
      />
      <ExportMappingButton 
        tenantId="123-abc"
        filters={{
          domain: 'access_control',
          type: 'preventive'
        }}
      />
    </div>
  )
}
```

## üîó Integra√ß√£o

O m√≥dulo se integra com:

- **Supabase**: Para persist√™ncia de dados
- **ShadCN UI**: Para componentes visuais
- **React Hook Form**: Para valida√ß√£o de formul√°rios
- **Zod**: Para schemas de valida√ß√£o
- **i18next**: Para internacionaliza√ß√£o
- **Tailwind CSS**: Para estiliza√ß√£o 